{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { openBlock as _openBlock, createElementBlock as _createElementBlock, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nconst _withScopeId = n => (_pushScopeId(\"data-v-255e0a9d\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = {\n  id: \"KMapChart\",\n  class: \"k-map-chart\"\n};\nimport { onMounted, ref, getCurrentInstance } from \"vue\";\nimport \"../mock/KMapMock\";\nexport default {\n  __name: 'KMapCharts',\n  setup(__props) {\n    var echarts = require(\"echarts/lib/echarts\");\n    require(\"echarts/lib/chart/graph\");\n    require(\"echarts/lib/component/tooltip\");\n    require(\"echarts/lib/component/title\");\n    const {\n      proxy\n    } = getCurrentInstance();\n    let KMapChart = null;\n    let kMapData = {};\n    const seriesData = ref([]);\n    const seriesLinks = ref([]);\n    const categories = ref([]);\n    // const lastClickId = ref(\"\");\n    const colors = [\"#a3d2ca\", \"#056676\", \"#ea2c62\", \"#16a596\", \"#03c4a1\", \"#f5a25d\", \"#8CD282\", \"#32e0c4\", \"#00FAE1\", \"#f05454\"];\n    onMounted(async () => {\n      await initKMapData();\n      console.log(\"完成init\", kMapData);\n      formatData(kMapData);\n      initKMapChart(); // 调用渲染函数\n    });\n\n    /**\n     * 初始化图表数据\n     */\n    async function initKMapData() {\n      return new Promise((resolve, reject) => {\n        proxy.$axios({\n          url: \"/getKMapData\",\n          method: \"get\"\n        }).then(res => {\n          kMapData = res.data.dataset;\n          resolve(); // 请求成功后调用 resolve\n        }).catch(error => {\n          reject(error); // 请求失败时调用 reject\n        });\n      });\n    }\n\n    /**\n     * 节点点击事件\n     */\n    async function nodeClick(params) {\n      const index = seriesData.value.findIndex(item => item.id === params.data.id);\n      console.log(\"点了节点：\" + (index + 1), \"clicked\");\n    }\n\n    /**\n     * 设置echarts配置项,重绘画布\n     */\n    async function initKMapChart() {\n      if (!KMapChart) {\n        console.log(\"KMapChart开始初始化\");\n        KMapChart = echarts.init(document.getElementById(\"KMapChart\"));\n        KMapChart.on(\"click\", params => {\n          if (params.dataType === \"node\") {\n            nodeClick(params); //判断点击的是图表的节点部分\n          }\n        });\n      }\n      // 指定图表的配置项和数据\n      let option = {\n        animationDurationUpdate: 500,\n        // 动画更新变化时间\n        animationEasingUpdate: \"quinticInOut\",\n        tooltip: {\n          show: false\n        },\n        series: [{\n          type: \"graph\",\n          layout: \"force\",\n          legendHoverLink: true,\n          //是否启用图例 hover(悬停) 时的联动高亮。\n          hoverAnimation: true,\n          //是否开启鼠标悬停节点的显示动画\n          focusNodeAdjacency: true,\n          edgeLabel: {\n            position: \"middle\",\n            //边上的文字样式\n            normal: {\n              show: true,\n              textStyle: {\n                fontSize: 12\n              },\n              position: \"middle\",\n              formatter: function (x) {\n                return x.data.name;\n              }\n            }\n          },\n          edgeSymbol: [\"\", \"arrow\"],\n          force: {\n            edgeLength: 15,\n            repulsion: 200\n          },\n          roam: true,\n          draggable: true,\n          //每个节点的拖拉\n          itemStyle: {\n            normal: {\n              color: \"#00FAE1\",\n              cursor: \"pointer\",\n              label: {\n                show: true,\n                position: [-10, -15],\n                textStyle: {\n                  //标签的字体样式\n                  color: \"#AB8\",\n                  //字体颜色\n                  fontStyle: \"normal\",\n                  //文字字体的风格 'normal'标准 'italic'斜体 'oblique' 倾斜\n                  fontWeight: \"bold\",\n                  //'normal'标准'bold'粗的'bolder'更粗的'lighter'更细的或100 | 200 | 300 | 400...\n                  fontFamily: \"sans-serif\",\n                  //文字的字体系列\n                  fontSize: 12 //字体大小\n                }\n              },\n              nodeStyle: {\n                brushType: \"both\",\n                borderColor: \"rgba(255,215,0,0.4)\",\n                borderWidth: 1\n              }\n            },\n            emphasis: {\n              //鼠标放上去有阴影效果\n              shadowColor: \"#00FAE1\",\n              shadowOffsetX: 0,\n              shadowOffsetY: 0,\n              shadowBlur: 40\n            }\n          },\n          lineStyle: {\n            width: 2\n          },\n          label: {\n            fontSize: 18\n          },\n          symbolSize: 24,\n          //节点大小\n          links: seriesLinks.value,\n          data: seriesData.value,\n          categories: categories.value,\n          cursor: \"pointer\"\n        }]\n      };\n      // 使用刚指定的配置项和数据显示图表。\n      KMapChart.setOption(option);\n    }\n\n    /**\n     * 格式化数据到表格需要的数据\n     */\n    function formatData(list) {\n      let nodes = list.nodes;\n      let links = list.links;\n      console.log(\"nodes:\", nodes);\n      console.log(\"links:\", links);\n      let colorIndex = 0;\n      let loadedCat = [];\n      nodes.forEach(item => {\n        if (item.categary && loadedCat.indexOf(item.categary) === -1) {\n          colorIndex = Math.floor(Math.random() * colors.length);\n          loadedCat.push(item.categary);\n          categories.value.push({\n            name: item.categary\n          });\n        }\n        item.itemStyle = {\n          color: colors[colorIndex],\n          borderColor: \"#ffffff\"\n        };\n        seriesData.value.push(item);\n      });\n      links.forEach(item => {\n        seriesLinks.value.push(item);\n      });\n      console.log(\"seriesData:\", seriesData.value);\n      console.log(\"seriesLinks:\", seriesLinks.value);\n    }\n    return (_ctx, _cache) => {\n      return _openBlock(), _createElementBlock(\"div\", _hoisted_1);\n    };\n  }\n};","map":{"version":3,"names":["onMounted","ref","getCurrentInstance","echarts","require","proxy","KMapChart","kMapData","seriesData","seriesLinks","categories","colors","initKMapData","console","log","formatData","initKMapChart","Promise","resolve","reject","$axios","url","method","then","res","data","dataset","catch","error","nodeClick","params","index","value","findIndex","item","id","init","document","getElementById","on","dataType","option","animationDurationUpdate","animationEasingUpdate","tooltip","show","series","type","layout","legendHoverLink","hoverAnimation","focusNodeAdjacency","edgeLabel","position","normal","textStyle","fontSize","formatter","x","name","edgeSymbol","force","edgeLength","repulsion","roam","draggable","itemStyle","color","cursor","label","fontStyle","fontWeight","fontFamily","nodeStyle","brushType","borderColor","borderWidth","emphasis","shadowColor","shadowOffsetX","shadowOffsetY","shadowBlur","lineStyle","width","symbolSize","links","setOption","list","nodes","colorIndex","loadedCat","forEach","categary","indexOf","Math","floor","random","length","push"],"sources":["D:/code/qd/seme/zmz/front-end/src/components/KMapCharts.vue"],"sourcesContent":["<template>\n  <div id=\"KMapChart\" class=\"k-map-chart\"></div>\n</template>\n\n<script setup>\nimport { onMounted, ref, getCurrentInstance } from \"vue\";\nvar echarts = require(\"echarts/lib/echarts\");\nrequire(\"echarts/lib/chart/graph\");\nrequire(\"echarts/lib/component/tooltip\");\nrequire(\"echarts/lib/component/title\");\n\nimport \"../mock/KMapMock\";\n\nconst { proxy } = getCurrentInstance();\nlet KMapChart = null;\nlet kMapData = {};\nconst seriesData = ref([]);\nconst seriesLinks = ref([]);\nconst categories = ref([]);\n// const lastClickId = ref(\"\");\nconst colors = [\n  \"#a3d2ca\",\n  \"#056676\",\n  \"#ea2c62\",\n  \"#16a596\",\n  \"#03c4a1\",\n  \"#f5a25d\",\n  \"#8CD282\",\n  \"#32e0c4\",\n  \"#00FAE1\",\n  \"#f05454\",\n];\n\nonMounted(async () => {\n  await initKMapData();\n  console.log(\"完成init\", kMapData);\n  formatData(kMapData);\n\n  initKMapChart(); // 调用渲染函数\n});\n\n/**\n * 初始化图表数据\n */\nasync function initKMapData() {\n  return new Promise((resolve, reject) => {\n    proxy\n      .$axios({\n        url: \"/getKMapData\",\n        method: \"get\",\n      })\n      .then((res) => {\n        kMapData = res.data.dataset;\n        resolve(); // 请求成功后调用 resolve\n      })\n      .catch((error) => {\n        reject(error); // 请求失败时调用 reject\n      });\n  });\n}\n\n/**\n * 节点点击事件\n */\nasync function nodeClick(params) {\n  const index = seriesData.value.findIndex(\n    (item) => item.id === params.data.id\n  );\n  console.log(\"点了节点：\" + (index + 1), \"clicked\");\n}\n\n/**\n * 设置echarts配置项,重绘画布\n */\nasync function initKMapChart() {\n  if (!KMapChart) {\n    console.log(\"KMapChart开始初始化\");\n    KMapChart = echarts.init(document.getElementById(\"KMapChart\"));\n    KMapChart.on(\"click\", (params) => {\n      if (params.dataType === \"node\") {\n        nodeClick(params); //判断点击的是图表的节点部分\n      }\n    });\n  }\n  // 指定图表的配置项和数据\n  let option = {\n    animationDurationUpdate: 500, // 动画更新变化时间\n    animationEasingUpdate: \"quinticInOut\",\n    tooltip: {\n      show: false,\n    },\n    series: [\n      {\n        type: \"graph\",\n        layout: \"force\",\n        legendHoverLink: true, //是否启用图例 hover(悬停) 时的联动高亮。\n        hoverAnimation: true, //是否开启鼠标悬停节点的显示动画\n        focusNodeAdjacency: true,\n        edgeLabel: {\n          position: \"middle\", //边上的文字样式\n          normal: {\n            show: true,\n            textStyle: {\n              fontSize: 12,\n            },\n            position: \"middle\",\n            formatter: function (x) {\n              return x.data.name;\n            },\n          },\n        },\n        edgeSymbol: [\"\", \"arrow\"],\n        force: {\n          edgeLength: 15,\n          repulsion: 200,\n        },\n        roam: true,\n        draggable: true, //每个节点的拖拉\n        itemStyle: {\n          normal: {\n            color: \"#00FAE1\",\n            cursor: \"pointer\",\n            label: {\n              show: true,\n              position: [-10, -15],\n              textStyle: {\n                //标签的字体样式\n                color: \"#AB8\", //字体颜色\n                fontStyle: \"normal\", //文字字体的风格 'normal'标准 'italic'斜体 'oblique' 倾斜\n                fontWeight: \"bold\", //'normal'标准'bold'粗的'bolder'更粗的'lighter'更细的或100 | 200 | 300 | 400...\n                fontFamily: \"sans-serif\", //文字的字体系列\n                fontSize: 12, //字体大小\n              },\n            },\n            nodeStyle: {\n              brushType: \"both\",\n              borderColor: \"rgba(255,215,0,0.4)\",\n              borderWidth: 1,\n            },\n          },\n          emphasis: {\n            //鼠标放上去有阴影效果\n            shadowColor: \"#00FAE1\",\n            shadowOffsetX: 0,\n            shadowOffsetY: 0,\n            shadowBlur: 40,\n          },\n        },\n        lineStyle: {\n          width: 2,\n        },\n        label: {\n          fontSize: 18,\n        },\n        symbolSize: 24, //节点大小\n        links: seriesLinks.value,\n        data: seriesData.value,\n        categories: categories.value,\n        cursor: \"pointer\",\n      },\n    ],\n  };\n  // 使用刚指定的配置项和数据显示图表。\n  KMapChart.setOption(option);\n}\n\n/**\n * 格式化数据到表格需要的数据\n */\nfunction formatData(list) {\n  let nodes = list.nodes;\n  let links = list.links;\n  console.log(\"nodes:\", nodes);\n  console.log(\"links:\", links);\n\n  let colorIndex = 0;\n  let loadedCat = [];\n  nodes.forEach((item) => {\n    if (item.categary && loadedCat.indexOf(item.categary) === -1) {\n      colorIndex = Math.floor(Math.random() * colors.length);\n      loadedCat.push(item.categary);\n      categories.value.push({ name: item.categary });\n    }\n    item.itemStyle = {\n      color: colors[colorIndex],\n      borderColor: \"#ffffff\",\n    };\n    seriesData.value.push(item);\n  });\n  links.forEach((item) => {\n    seriesLinks.value.push(item);\n  });\n  console.log(\"seriesData:\", seriesData.value);\n  console.log(\"seriesLinks:\", seriesLinks.value);\n}\n</script>\n\n<style scoped>\n.k-map-chart {\n  height: 80vh;\n  width: 100%;\n}\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}